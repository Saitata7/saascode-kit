# SaasCode Kit â€” Input Validation Rules
# For frameworks with decorator-based validation (NestJS + class-validator)

rules:
  # WARNING: DTO class without any validation decorators
  - id: dto-without-validation
    message: |
      DTO class has no validation decorators (@IsString, @IsEmail, @MaxLength, etc.).
      All input fields should have validation to prevent invalid/malicious data.
    severity: WARNING
    languages: [typescript]
    patterns:
      - pattern: |
          class $DTO {
            $FIELD: $TYPE;
          }
      - pattern-not-inside: |
          class $DTO {
            @$DECORATOR(...)
            ...
          }
      - metavariable-regex:
          metavariable: $DTO
          regex: ".*Dto$"

  # WARNING: String field without max length
  - id: string-without-max-length
    message: |
      String field without @MaxLength() constraint. Unbounded strings can cause
      storage issues and potential DoS. Add @MaxLength(255) or appropriate limit.
    severity: WARNING
    languages: [typescript]
    patterns:
      - pattern: |
          @IsString()
          $FIELD: string;
      - pattern-not-inside: |
          @MaxLength(...)
          ...
          $FIELD: string;

  # WARNING: Email field without email validation
  - id: email-without-validation
    message: |
      Field named 'email' without @IsEmail() validation.
      Add @IsEmail() to validate email format.
    severity: WARNING
    languages: [typescript]
    patterns:
      - pattern: |
          $EMAIL: string;
      - pattern-not-inside: |
          @IsEmail(...)
          ...
      - metavariable-regex:
          metavariable: $EMAIL
          regex: ".*[Ee]mail.*"

  # WARNING: Optional field without @IsOptional
  - id: optional-without-decorator
    message: |
      Optional TypeScript field (?) without @IsOptional() decorator.
      class-validator requires @IsOptional() to skip validation when field is undefined.
    severity: WARNING
    languages: [typescript]
    patterns:
      - pattern: |
          $FIELD?: $TYPE;
      - pattern-not-inside: |
          @IsOptional()
          ...
          $FIELD?: $TYPE;
      - pattern-inside: |
          class $DTO {
            ...
          }
      - metavariable-regex:
          metavariable: $DTO
          regex: ".*Dto$"
