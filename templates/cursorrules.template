# {{project.name}} — Cursor Rules
# Auto-generated by SaasCode Kit from manifest.yaml

# Project
You are working on {{project.name}}, a {{project.type}} {{project.domain}} application.

# Stack
- Frontend: {{stack.frontend.framework}} {{stack.frontend.version}} + {{stack.frontend.ui_library}} + {{stack.frontend.css}}
- Backend: {{stack.backend.framework}} {{stack.backend.version}} + {{stack.backend.orm}} + {{stack.backend.database}}
- Auth: {{auth.provider}}
{{#if billing.enabled}}- Billing: {{billing.provider}} ({{billing.model}}){{/if}}
{{#if ai.enabled}}- AI: {{ai.providers}}{{/if}}
- Language: {{stack.language}}

# Structure
- Backend: {{paths.backend}}/src/modules/[feature]/
- Frontend pages: {{paths.frontend}}/src/app/
- Frontend components: {{paths.components}}/
- API client: {{paths.api_client}}/
- DB schema: {{paths.schema}}
{{#if paths.shared}}- Shared types: {{paths.shared}}/{{/if}}

# Build Order (ALWAYS follow)
1. Database Schema → 2. DTOs → 3. Service → 4. Controller → 5. Module → 6. API Client → 7. Components → 8. Pages

{{#if_eq auth.guard_pattern "decorator"}}
# Auth Guard Chain (CRITICAL)
All tenant controllers MUST use:
```
@UseGuards(AuthGuard, TenantGuard, RolesGuard)
@Roles(Role.OWNER, Role.ADMIN)
```
BUG: @Roles() without RolesGuard = roles NOT enforced (decorator silently ignored)
{{/if_eq}}

{{#if_eq auth.guard_pattern "middleware"}}
# Auth Middleware Chain (CRITICAL)
All tenant routes MUST use:
```
router.use(authenticate, resolveTenant, checkRole('OWNER'));
```
BUG: Missing tenant middleware = cross-tenant data access
{{/if_eq}}

{{#if tenancy.enabled}}
# Tenant Isolation (CRITICAL)
- ALWAYS include {{tenancy.identifier}} in findMany where clauses
- ALWAYS verify ownership after findUnique: record.{{tenancy.identifier}} === {{tenancy.identifier}}
- NEVER return unscoped queries — this leaks ALL tenants' data
{{/if}}

# Endpoint Parity
Every apiClient call in {{paths.api_client}}/ MUST have a matching @Method() in a controller.
Frontend call without backend endpoint = 404 at runtime.

# Patterns
{{#each patterns.critical}}
- {{this.id}}: {{this.description}} → CORRECT: {{this.correct}}
{{/each}}

# Do NOT
- Add features not requested
- Skip {{tenancy.identifier}} scoping on tenant data
- Use dangerouslySetInnerHTML with user input
- Hardcode secrets — use env vars
- Create frontend API calls without backend endpoints
- Use console.log in production backend code
- Change auth/billing without asking
{{#if patterns.colors}}- Use {{patterns.colors.forbidden_in_tenant}} colors in tenant UI{{/if}}
